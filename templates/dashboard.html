{% extends "base.html" %}

{% block page_title %}Dashboard{% endblock %}

{% block page_subtitle %}System overview and quick access to configuration and monitoring{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Welcome Section -->
    <div class="welcome-section">
        <div class="welcome-card">
            <h3>Welcome to Alpaca Telescope Driver</h3>
            <p>Your telescope control system is running and ready. Use the navigation panel or quick access buttons below to manage your system.</p>
            <div class="system-version">
                <span>Driver Version: {{ status.driver_version | default('1.0.0') }}</span>
                <span>&bull;</span>
                <span>Server: {{ server_config.ip_address }}:{{ server_config.port }}</span>
            </div>
        </div>
    </div>

    <!-- System Health Status -->
    <div class="health-section">
        <h3 class="section-title">System Health</h3>
        <div class="health-grid">
            <div class="health-card {{ 'healthy' if status.server_running else 'unhealthy' }}">
                <div class="health-icon">üñ•Ô∏è</div>
                <div class="health-info">
                    <h4>Server Status</h4>
                    <p>{{ 'Running' if status.server_running else 'Stopped' }}</p>
                    <small>Uptime: {{ status.uptime | default('Unknown') }}</small>
                </div>
            </div>

            <div class="health-card {{ 'healthy' if status.discovery_active else 'unhealthy' }}">
                <div class="health-icon">üì°</div>
                <div class="health-info">
                    <h4>Discovery Service</h4>
                    <p>{{ 'Active' if status.discovery_active else 'Inactive' }}</p>
                    <small>Broadcasts: {{ status.discovery_broadcasts | default('0') }}</small>
                </div>
            </div>

            <div class="health-card {{ 'healthy' if telescope_status.connected else 'warning' }}">
                <div class="health-icon">üî≠</div>
                <div class="health-info">
                    <h4>Telescope</h4>
                    <p>{{ 'Connected' if telescope_status.connected else 'Disconnected' }}</p>
                    <small>{{ telescope_status.name | default('No telescope') }}</small>
                </div>
            </div>

            <div class="health-card {{ 'healthy' if status.config_valid else 'unhealthy' }}">
                <div class="health-icon">‚öôÔ∏è</div>
                <div class="health-info">
                    <h4>Configuration</h4>
                    <p>{{ 'Valid' if status.config_valid else 'Invalid' }}</p>
                    <small>Last updated: {{ status.last_config_change | default('Unknown') }}</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="actions-section">
        <h3 class="section-title">Quick Access</h3>
        <div class="action-grid">
            <a href="/server-config" class="action-card">
                <div class="action-icon">üñ•Ô∏è</div>
                <div class="action-content">
                    <h4>Server Configuration</h4>
                    <p>Configure network settings, logging, and server parameters</p>
                </div>
                <div class="action-arrow">‚Üí</div>
            </a>

            <a href="/telescope-config" class="action-card">
                <div class="action-icon">üî≠</div>
                <div class="action-content">
                    <h4>Telescope Configuration</h4>
                    <p>Set up telescope capabilities and operational parameters</p>
                </div>
                <div class="action-arrow">‚Üí</div>
            </a>

            <a href="/telescope-status" class="action-card">
                <div class="action-icon">üìä</div>
                <div class="action-content">
                    <h4>Telescope Status</h4>
                    <p>Monitor real-time telescope status and coordinates</p>
                </div>
                <div class="action-arrow">‚Üí</div>
            </a>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="activity-section">
        <h3 class="section-title">Recent Activity</h3>
        <div class="activity-container" 
             hx-get="/htmx/recent-activity" 
             hx-trigger="load, every 30s"
             hx-swap="innerHTML">
            <div class="activity-list">
                {% if recent_activity %}
                    {% for activity in recent_activity %}
                    <div class="activity-item {{ activity.type }}">
                        <div class="activity-time">{{ activity.timestamp }}</div>
                        <div class="activity-message">{{ activity.message }}</div>
                    </div>
                    {% endfor %}
                {% else %}
                <div class="activity-item info">
                    <div class="activity-time">{{ status.server_start_time | default('Unknown') }}</div>
                    <div class="activity-message">Server started successfully</div>
                </div>
                <div class="activity-item info">
                    <div class="activity-time">{{ status.discovery_start_time | default('Unknown') }}</div>
                    <div class="activity-message">Discovery service activated</div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- System Statistics -->
    <div class="stats-section">
        <h3 class="section-title">System Statistics</h3>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value">{{ status.connected_clients | default('0') }}</div>
                <div class="stat-label">Connected Clients</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ status.total_requests | default('0') }}</div>
                <div class="stat-label">Total Requests</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ status.memory_usage | default('Unknown') }}</div>
                <div class="stat-label">Memory Usage</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ status.log_entries | default('0') }}</div>
                <div class="stat-label">Log Entries</div>
            </div>
        </div>
    </div>
</div>

<style>
/* Dashboard Specific Styles */
.dashboard-container {
    max-width: 1200px;
    margin: 0 auto;
}

.section-title {
    font-size: 1.4rem;
    color: #333;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 2px solid #667eea;
}

/* Welcome Section */
.welcome-section {
    margin-bottom: 40px;
}

.welcome-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
}

.welcome-card h3 {
    font-size: 1.8rem;
    margin-bottom: 10px;
}

.welcome-card p {
    font-size: 1.1rem;
    margin-bottom: 20px;
    opacity: 0.9;
}

.system-version {
    display: flex;
    gap: 10px;
    font-size: 0.9rem;
    opacity: 0.8;
}

/* Health Section */
.health-section {
    margin-bottom: 40px;
}

.health-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
}

.health-card {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    border-left: 4px solid #ccc;
    display: flex;
    align-items: center;
    gap: 15px;
    transition: transform 0.2s ease;
}

.health-card:hover {
    transform: translateY(-2px);
}

.health-card.healthy {
    border-left-color: #28a745;
}

.health-card.warning {
    border-left-color: #ffc107;
}

.health-card.unhealthy {
    border-left-color: #dc3545;
}

.health-icon {
    font-size: 2rem;
}

.health-info h4 {
    margin: 0 0 5px 0;
    color: #333;
}

.health-info p {
    margin: 0 0 5px 0;
    font-weight: 500;
}

.health-card.healthy .health-info p {
    color: #28a745;
}

.health-card.warning .health-info p {
    color: #856404;
}

.health-card.unhealthy .health-info p {
    color: #dc3545;
}

.health-info small {
    color: #6c757d;
    font-size: 0.8rem;
}

/* Quick Actions */
.actions-section {
    margin-bottom: 40px;
}

.action-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
}

.action-card {
    background: white;
    padding: 25px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    border: 1px solid #e9ecef;
    text-decoration: none;
    color: inherit;
    display: flex;
    align-items: center;
    gap: 20px;
    transition: all 0.3s ease;
}

.action-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    text-decoration: none;
    color: inherit;
}

.action-icon {
    font-size: 2.5rem;
    flex-shrink: 0;
}

.action-content {
    flex: 1;
}

.action-content h4 {
    margin: 0 0 8px 0;
    color: #333;
    font-size: 1.2rem;
}

.action-content p {
    margin: 0;
    color: #666;
    font-size: 0.95rem;
}

.action-arrow {
    font-size: 1.5rem;
    color: #667eea;
    flex-shrink: 0;
}

/* Recent Activity */
.activity-section {
    margin-bottom: 40px;
}

.activity-container {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    border: 1px solid #e9ecef;
}

.activity-list {
    padding: 20px;
}

.activity-item {
    display: flex;
    gap: 15px;
    padding: 10px 0;
    border-bottom: 1px solid #f8f9fa;
    align-items: center;
}

.activity-item:last-child {
    border-bottom: none;
}

.activity-time {
    font-size: 0.85rem;
    color: #6c757d;
    min-width: 120px;
    font-family: 'Courier New', monospace;
}

.activity-message {
    flex: 1;
    color: #333;
}

.activity-item.info .activity-message::before {
    content: "‚ÑπÔ∏è ";
}

.activity-item.success .activity-message::before {
    content: "‚úÖ ";
}

.activity-item.warning .activity-message::before {
    content: "‚ö†Ô∏è ";
}

.activity-item.error .activity-message::before {
    content: "‚ùå ";
}

/* System Statistics */
.stats-section {
    margin-bottom: 40px;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 20px;
}

.stat-card {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    border: 1px solid #e9ecef;
    text-align: center;
}

.stat-value {
    font-size: 2rem;
    font-weight: bold;
    color: #667eea;
    margin-bottom: 5px;
}

.stat-label {
    font-size: 0.9rem;
    color: #6c757d;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* Responsive Design */
@media (max-width: 768px) {
    .health-grid {
        grid-template-columns: 1fr;
    }
    
    .action-grid {
        grid-template-columns: 1fr;
    }
    
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .action-card {
        padding: 20px;
    }
    
    .welcome-card {
        padding: 20px;
    }
    
    .system-version {
        flex-direction: column;
        gap: 5px;
    }
}
</style>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auto-refresh system health every 30 seconds
    setInterval(function() {
        if (document.querySelector('.health-grid')) {
            fetch('/htmx/system-health')
                .then(response => response.text())
                .then(html => {
                    // Update health cards if endpoint exists
                });
        }
    }, 30000);
    
    // Add click animations to action cards
    document.querySelectorAll('.action-card').forEach(card => {
        card.addEventListener('click', function(e) {
            this.style.transform = 'scale(0.98)';
            setTimeout(() => {
                this.style.transform = '';
            }, 100);
        });
    });
});
</script>
{% endblock %}